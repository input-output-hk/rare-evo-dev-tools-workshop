# The "Always True" Script in Aiken

First, ensure you have Aiken installed by following the official guide at:
[https://aiken-lang.org/installation-instructions](https://aiken-lang.org/installation-instructions)

We will start with arguably the simplest script you can build in Aiken: the "Always True" validator. This script will always succeed when attempting to spend a UTxO locked by it, making it an excellent starting point for understanding the basic development workflow.

Here is the complete source code:

```aiken
use cardano/transaction.{OutputReference, Transaction}

validator alwaysTrue {
  spend(
    _datum: Option<Data>,
    _redeemer: Data,
    _utxo: OutputReference,
    _self: Transaction,
  ) {
    True
  }

  else(_) {
    fail
  }
}
```

Running `aiken check` will install any necessary dependencies, type-check your Aiken project, and run any tests it finds.

```shell
aiken check
```shell
    Compiling rare/alwaystrue 0.0.0 (.)
    Compiling aiken-lang/stdlib v2.2.0 (./build/packages/aiken-lang-stdlib)
   Collecting all tests scenarios across all modules
      Summary 0 errors, 0 warnings
```

Next, the `aiken build` command compiles the script and generates a `plutus.json` file. This file, known as a "blueprint," contains the compiled validator code and metadata about your project.

```shell
aiken build
```

```shell
    Compiling rare/alwaystrue 0.0.0 (.)
    Compiling aiken-lang/stdlib v2.2.0 (./build/packages/aiken-lang-stdlib)
   Generating project's blueprint (./plutus.json)
      Summary 0 errors, 0 warnings
```

The generated `plutus.json` blueprint looks like this:

```json
{
  "preamble": {
    "title": "rare/alwaystrue",
    "description": "Aiken contracts for project 'rare/alwaystrue'",
    "version": "0.0.0",
    "plutusVersion": "v3",
    "compiler": {
      "name": "Aiken",
      "version": "v1.1.17+c3a7fba"
    },
    "license": "Apache-2.0"
  },
  "validators": [
    {
      "title": "always_true.alwaysTrue.spend",
      "datum": {
        "title": "_datum",
        "schema": {
          "$ref": "#/definitions/Data"
        }
      },
      "redeemer": {
        "title": "_redeemer",
        "schema": {
          "$ref": "#/definitions/Data"
        }
      },
      "compiledCode": "585c01010029800aba2aba1aab9eaab9dab9a4888896600264653001300600198031803800cc0180092225980099b8748008c01cdd500144c8cc892898050009805180580098041baa0028b200c180300098019baa0068a4d13656400401",
      "hash": "d27ccc13fab5b782984a3d1f99353197ca1a81be069941ffc003ee75"
    },
    {
      "title": "always_true.alwaysTrue.else",
      "redeemer": {
        "schema": {}
      },
      "compiledCode": "585c01010029800aba2aba1aab9eaab9dab9a4888896600264653001300600198031803800cc0180092225980099b8748008c01cdd500144c8cc892898050009805180580098041baa0028b200c180300098019baa0068a4d13656400401",
      "hash": "d27ccc13fab5b782984a3d1f99353197ca1a81be069941ffc003ee75"
    }
  ],
  "definitions": {
    "Data": {
      "title": "Data",
      "description": "Any Plutus data."
    }
  }
}
```

To use this with `cardano-cli`, we need to convert the blueprint into a simpler format.

```shell
aiken blueprint convert > alwaystrue.json
```

This command extracts the compiled code and creates a new file, `alwaystrue.json`, that `cardano-cli` can understand.

```json
{
  "type": "PlutusScriptV3",
  "description": "Generated by Aiken",
  "cborHex": "585e585c01010029800aba2aba1aab9eaab9dab9a4888896600264653001300600198031803800cc0180092225980099b8748008c01cdd500144c8cc892898050009805180580098041baa0028b200c180300098019baa0068a4d13656400401"
}
```

### Locking Funds in the Script

Now that we have a compiled script, let's generate a script address. From the root of your repository, run:

```shell
cardano-cli conway address build \
  --payment-script-file alwaystrue/alwaystrue.json \
  --out-file mytestnet/alwaystrue.addr
```

You can view the newly generated address:
```shell
cat mytestnet/alwaystrue.addr
```

Next, we'll have `delegator1` lock 900 ADA at this script address. First, let's find a suitable UTxO in `delegator1`'s wallet.

```shell
cardano-cli conway query utxo --address $(< mytestnet/stake-delegators/delegator1/payment.addr) --output-text
```
Let's use the UTxO that contains 1000 ADA.
```
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
4d2d31622be9d29a51aa2113448bee9212aa0fcc59737f71d4addeaaa8647632     0        1000000000 lovelace + TxOutDatumNone
4d2d31622be9d29a51aa2113448bee9212aa0fcc59737f71d4addeaaa8647632     1        5000000 lovelace + TxOutDatumNone
8470be5ffbe0464e74eed68f39d631c5cc64d775147f453f4938adedf443e585     0        15000003000000 lovelace + TxOutDatumNone
```

Now, build the transaction, using the script address as the output destination.

```shell
cardano-cli conway transaction build \
  --tx-in $(cardano-cli conway query utxo --address $(< mytestnet/stake-delegators/delegator1/payment.addr) | jq -r 'keys[0]') \
  --tx-out $(< mytestnet/alwaystrue.addr)+900000000 \
  --change-address $(< mytestnet/stake-delegators/delegator1/payment.addr) \
  --out-file mytestnet/tx.raw
```
Sign the transaction with `delegator1`'s key.

```shell
cardano-cli conway transaction sign \
  --tx-file mytestnet/tx.raw \
  --signing-key-file mytestnet/stake-delegators/delegator1/payment.skey \
  --out-file mytestnet/tx.signed 
```

Finally, submit it to the blockchain.

```shell
cardano-cli conway transaction submit --tx-file mytestnet/tx.signed
```

You can now verify that the funds are locked at the script address.

```shell
cardano-cli conway query utxo --address $(< mytestnet/alwaystrue.addr) 
```json
{
    "a3b214e3382daabdae552fbe1719c3e568218942c6be043425d4fed8491b190a#0": {
        "address": "addr_test1wrf8enqnl26m0q5cfg73lxf4xxtu5x5phcrfjs0lcqp7uagh2hm3k",
        "datum": null,
        "datumhash": "5e616ae3e8f19d5e81becbd92022c22bb398e3e91499809173c61cb0d69aea92",
        "inlineDatum": null,
        "inlineDatumRaw": null,
        "referenceScript": null,
        "value": {
            "lovelace": 900000000
        }
    }
}
```
### Spending Funds from the Script

Now, let's build a transaction to spend the UTxO we just locked.

When spending from a script, you must provide:
- **Collateral**: A separate UTxO from your wallet to cover potential script execution failures.
- **The Script File**: The `alwaystrue.json` file we created.
- **A Redeemer**: Data passed to the validator. For this simple script, an empty datum `{}` suffices.

```shell
cardano-cli conway transaction build \
  --tx-in-collateral $(cardano-cli conway query utxo --address $(< mytestnet/stake-delegators/delegator1/payment.addr) | jq -r 'keys[0]') \
  --tx-in $(cardano-cli conway query utxo --address $(< mytestnet/alwaystrue.addr) | jq -r 'keys[0]') \
  --tx-in-script-file alwaystrue/alwaystrue.json \
  --tx-in-redeemer-value {} \
  --change-address $(< mytestnet/stake-delegators/delegator1/payment.addr) \
  --out-file mytestnet/unlocktx.raw
```

Sign the unlocking transaction.

```shell
cardano-cli conway transaction sign \
  --tx-file  mytestnet/unlocktx.raw \
  --signing-key-file mytestnet/stake-delegators/delegator1/payment.skey \
  --out-file mytestnet/unlocktx.signed
```
And submit it to the network.

```shell
cardano-cli conway transaction submit \
  --tx-file mytestnet/unlocktx.signed
```

If successful, the 900 ADA (minus transaction fees) will be returned to the `delegator1` address.
